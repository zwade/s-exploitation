FROM node:10.0.0
RUN mkdir /app
WORKDIR /app/updator
EXPOSE 23456
EXPOSE 27017
ENV updator "sexp-updator.chal.pwning.xxx"
ENV samoa "sexp-samoauth.chal.pwning.xxx"
ENV flag "PCTF{I_prefer_the_0r1g1n4l_won}"
ENV secret "we gotta keep dem cookies top secret bois"
ENV sitekey "6LceOVYUAAAAAOImz6_dV5GAN5dGy54LzNNKDzfz"
ENV secretkey "6LceOVYUAAAAAPu8ILzTMPsKJYsUitVAp50fyACm"
ENV DB_URL mongo

ADD ./upd8t0r /app/updator
ADD ./native-sexp /app/native-sexp

RUN npm install
RUN npm install -g forever node-gyp

WORKDIR /app/native-sexp
RUN node-gyp configure && node-gyp build

RUN cp build/Release/sexp.node /app/native-sexp.node
WORKDIR app
RUN rm -rf native-sexp

RUN useradd pctf
USER pctf

WORKDIR /app/updator

CMD ["forever", "index.js"]

