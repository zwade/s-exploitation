<html>
	<head>
		<link href="https://fonts.googleapis.com/css?family=Do+Hyeon" rel="stylesheet">
		<link href="/files/client/main.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/ractive" nonce="{{nonce}}"></script>
	</head>

	<body>
		<div id="ractive"></div>

		<script type="application/ractive" id="main">

<div class="main-container">
	<div class="head">
		<h1> Upd8t0r </h1>
	</div>
	<h4> All the latest news about the adobe flash updater </h4>
	{{> page}}
	<div class="footer">&copy; whatever year it is @zwad3 ⛳️</div>
</div>

		</script>

		<script type="application/ractive" id="home">
<div class="posts">
{{#each posts}}
	<div class="post" on-click="['goTo', id]">
		<div class="title">{{title}}</div>
		<div class="desc">{{abbrev(body)}}</div>
	</div>
{{/each}}
</div>
		</script>

		<script nonce="{{nonce}}">

let templates = {
	"/": "home",
}

let decodeUri = (search) => {
	let out = {};
	for (let i of search.split("&")) {
		let [key, value] = i.split("=");
		out[key] = value
	}
	return out;
}

let decodeCookie = () => {
	let out = {}
	for (let i of document.cookie.split("; ")) {
		let [key, value] = i.split("=");
		out[key] = value
	}
	return out;
}

let cookies = decodeCookie();
let session = cookies.session ? JSON.parse(atob(cookies.session))["id"] : null

let ractive = new Ractive({
	target: "#ractive",
	template: "#main",
	data: {
		uri: decodeUri(location.search.slice(1)),
		session,
	}
})

fetch("/posts", { credentials: "include" } )
	.then(e => e.json())
	.then(e => ractive.set("posts", e))

ractive.set("page", templates[location.pathname] || templates["/"]);
ractive.set("abbrev", s => {
	if (s.length < 128) return s;
	else return s.slice(0, 125) + "...";
})
ractive.on({
	setPath: (f, v) =>
		ractive.set("page", templates[v]),
	goTo: (f, id) =>
		location.href = `/posts/${id}`
})

		</script>
	</body>

</html>
